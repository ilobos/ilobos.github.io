{"title":"Vue3跨页面监听缓存数据","uid":"de6e63237e5b53276002403454a7e954","slug":"vue/001-storage-event-listener","date":"2022-06-02T05:20:13.000Z","updated":"2022-06-05T12:34:45.850Z","comments":true,"path":"api/articles/vue/001-storage-event-listener.json","keywords":null,"cover":"https://images.pexels.com/photos/290470/pexels-photo-290470.jpeg?auto=compress&cs=tinysrgb&dpr=3&h=750&w=1260","content":"<hr>\n<h5 id=\"1、背景\"><a href=\"#1、背景\" class=\"headerlink\" title=\"1、背景\"></a>1、背景</h5><p>当我们期望页面上的某些按钮的状态随着缓存数据的变化而变化，但是这个缓存数据的变化可能是来自其他页面，我们就需要通过创建自定义监听事件来完成该项工作，即：B页面的按钮状态随A页面的缓存变化而变化。</p>\n<h5 id=\"2、创建监听事件\"><a href=\"#2、创建监听事件\" class=\"headerlink\" title=\"2、创建监听事件\"></a>2、创建监听事件</h5><p>改造main.js，在main.js文件中，加入代码，结构如下，其中如何创建一个StorageEvent事件，需要根据实际情况进行改造，需要适配自己的vue版本即可，本文使用的是：vm.config.globalProperties.$addStorageEvent；</p>\n<div align=center>\n  <img src=\"../../img/vue/001-storage-share-01.png\" width=\"80%\">\n</div>\n\n<pre class=\"language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; 创建一个StorageEvent事件\nvm.config.globalProperties.$addStorageEvent &#x3D; function(key, data) &#123;\n    var newStorageEvent &#x3D; document.createEvent(&#39;StorageEvent&#39;);\n    const storage &#x3D; &#123;\n        setItem: function(k, val) &#123;\n            localStorage.setItem(k, val);\n            &#x2F;&#x2F; 初始化创建的事件\n            newStorageEvent.initStorageEvent(&#39;setItem&#39;, false, false, k, null, val, null, null);\n            &#x2F;&#x2F; 派发对象\n            window.dispatchEvent(newStorageEvent);\n        &#125;\n    &#125;\n    return storage.setItem(key, data);\n&#125;</code></pre>\n\n<h5 id=\"3、触发事件\"><a href=\"#3、触发事件\" class=\"headerlink\" title=\"3、触发事件\"></a>3、触发事件</h5><p>在期望监听的缓存参数，设定值的时候通过以下方式调用：</p>\n<pre class=\"language-js\" data-language=\"js\"><code class=\"language-js\">this.$addStorageEvent(&quot;some-key&quot;, &quot;some-value&quot;);</code></pre>\n\n<h5 id=\"4、监听事件\"><a href=\"#4、监听事件\" class=\"headerlink\" title=\"4、监听事件\"></a>4、监听事件</h5><p>在mounted中添加监听事件，</p>\n<pre class=\"language-js\" data-language=\"js\"><code class=\"language-js\">mounted() &#123;\n  &#x2F;&#x2F; 监听缓存中指定key的值变化\n  window.addEventListener(&quot;setItem&quot;, this.hello);\n&#125;,</code></pre>\n<p>在method中添加对应的方法，进行业务处理，</p>\n<pre class=\"language-js\" data-language=\"js\"><code class=\"language-js\">&#x2F;&#x2F; 根据指定key的值变化进行对应的业务操作\nhello(e) &#123;\n  console.log(&quot;hello , data is changed&quot;, e.key, e.newValue);\n  if(e.key &amp;&amp; e.key &#x3D;&#x3D; &#39;some-key&#39; &amp;&amp; e.newValue) &#123;\n    this.some_key &#x3D; e.newValue;\n  &#125;\n&#125;</code></pre>\n<h5 id=\"5、ALL-DONE\"><a href=\"#5、ALL-DONE\" class=\"headerlink\" title=\"5、ALL DONE\"></a>5、ALL DONE</h5><hr>\n","feature":true,"text":" 1、背景当我们期望页面上的某些按钮的状态随着缓存数据的变化而变化，但是这个缓存数据的变化可能是来自其他页面，我们就需要通过创建自定义监听事件来完成该项工作，即：B页面的按钮状态随A页面的缓存变化而变化。 2、创建监听事件改造main.js，在main.js文件中，加入代码，结构...","link":"","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"Vue3","slug":"Vue3","count":1,"path":"api/categories/Vue3.json"}],"tags":[{"name":"Storage","slug":"Storage","count":1,"path":"api/tags/Storage.json"},{"name":"Listener","slug":"Listener","count":1,"path":"api/tags/Listener.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#1%E3%80%81%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">1、背景</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#2%E3%80%81%E5%88%9B%E5%BB%BA%E7%9B%91%E5%90%AC%E4%BA%8B%E4%BB%B6\"><span class=\"toc-text\">2、创建监听事件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#3%E3%80%81%E8%A7%A6%E5%8F%91%E4%BA%8B%E4%BB%B6\"><span class=\"toc-text\">3、触发事件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#4%E3%80%81%E7%9B%91%E5%90%AC%E4%BA%8B%E4%BB%B6\"><span class=\"toc-text\">4、监听事件</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#5%E3%80%81ALL-DONE\"><span class=\"toc-text\">5、ALL DONE</span></a></li></ol>","author":{"name":"ilobos","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"直面挑战 躬身入局","socials":{"github":"https://github.com/ilobos/","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/ilobos/"}}}},"mapped":true,"prev_post":{"title":"GitTree保持一条线","uid":"77cf03d322bc183735b2daa0ceb4d64b","slug":"share/003-git-rebase","date":"2022-06-05T09:20:13.000Z","updated":"2022-06-05T12:12:22.593Z","comments":true,"path":"api/articles/share/003-git-rebase.json","keywords":null,"cover":"https://images.pexels.com/photos/290470/pexels-photo-290470.jpeg?auto=compress&cs=tinysrgb&dpr=3&h=750&w=1260","text":" 说明有些场景，或者强迫症患者，希望Tree是一条直线，特别是在多仓库、多分支的情况下，一条线看着确实相对舒服。 需求我们在dev分支开发好代码之后，期望合并到test分支，以下步骤可以让我们保持一条线，并且保障commit不会多次出现。 1、Rebase在dev分支执行reba...","link":"","photos":[],"count_time":{"symbolsCount":254,"symbolsTime":"1 mins."},"categories":[{"name":"GIT","slug":"GIT","count":1,"path":"api/categories/GIT.json"}],"tags":[{"name":"Rebase","slug":"Rebase","count":1,"path":"api/tags/Rebase.json"}],"author":{"name":"ilobos","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"直面挑战 躬身入局","socials":{"github":"https://github.com/ilobos/","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/ilobos/"}}}},"feature":true},"next_post":{"title":"INNO-SETUP使用指南","uid":"5252c7317051d246dedef9f207f9d6dd","slug":"win/006-inno-setup","date":"2022-05-20T14:21:13.000Z","updated":"2022-06-05T13:51:14.233Z","comments":true,"path":"api/articles/win/006-inno-setup.json","keywords":null,"cover":"https://images.pexels.com/photos/290470/pexels-photo-290470.jpeg?auto=compress&cs=tinysrgb&dpr=3&h=750&w=1260","text":"0、安装INNO-SETUP点击下载INNO-SETUP，提取码：5f5g 1、选择向导打开软件之后，使用向导模式 2、向导欢迎页直接下一步即可 3、填写应用信息按需填写程序名称等信息 4、配置文件夹信息此处无需额外配置，直接下一步即可 5、配置文件夹选择主执行程序，并且可以按需...","link":"","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"Windows","slug":"Windows","count":7,"path":"api/categories/Windows.json"}],"tags":[{"name":"INNO-SETUP","slug":"INNO-SETUP","count":1,"path":"api/tags/INNO-SETUP.json"}],"author":{"name":"ilobos","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"直面挑战 躬身入局","socials":{"github":"https://github.com/ilobos/","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"gitee":{"icon":"/svg/gitee.svg","link":"https://gitee.com/ilobos/"}}}},"feature":true}}